---
title: 'Next.js App Router 踩坑记录'
publishedAt: '2025-01-25'
summary: '从 Pages Router 迁移到 App Router 过程中遇到的问题和解决方案。'
---

## Server Components vs Client Components

最大的心智转变是理解 Server Components 和 Client Components 的边界。

```tsx
// 这是 Server Component（默认）
async function PostList() {
  const posts = await getPosts() // 可以直接调用数据库
  return (
    <ul>
      {posts.map(post => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}

// 需要交互时才用 Client Component
'use client'
function LikeButton() {
  const [liked, setLiked] = useState(false)
  return <button onClick={() => setLiked(!liked)}>Like</button>
}
```

## 常见坑点

### 1. useSearchParams 需要 Suspense

```tsx
// 错误：直接使用会报错
function Page() {
  const params = useSearchParams()
  return <div>{params.get('q')}</div>
}

// 正确：需要用 Suspense 包裹
function Page() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <SearchContent />
    </Suspense>
  )
}
```

### 2. 动态路由的 generateStaticParams

```tsx
export async function generateStaticParams() {
  const posts = await getPosts()
  return posts.map(post => ({ slug: post.slug }))
}
```

### 3. Metadata 导出

```tsx
// 静态 metadata
export const metadata = {
  title: 'My Page',
}

// 动态 metadata
export async function generateMetadata({ params }) {
  const post = await getPost(params.slug)
  return { title: post.title }
}
```

App Router 的学习曲线确实比较陡，但理解了核心概念后，开发体验非常好。
